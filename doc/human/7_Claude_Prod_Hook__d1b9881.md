# 7 Claude Prod Hook

> **Document Analysis:** This document has been processed through the enhanced ingest workflow with UML glossary integration and classified as a **use_case** type (behavioral subtype).

## Document Overview

**Source:** 7_claude_prod_hook__d1b9881.md  
**Processed:** 2026-01-29 19:31:13  
**Git SHA:** 08c66b918ce9bee3c0c5dd9a0606e17b74f8eea6  
**UUID7:** d1b9881  
**Word Count:** 1994 words  
**Main Sections:** Block dangerous bash commands, Block modifications to sensitive files, Rotate logs older than 90 days, Find all file modifications in last 7 days, Critical: block on security violations, Important but not blocking: warn and fix  
**UML Classification:** use_case (behavioral)  

## Visual Resources

### ðŸŽ¯ UML Diagram
**Type:** Use Case Diagram  
**Subtype:** behavioral  
**File:** [7_Claude_Prod_Hook__use_case__d1b9881.puml](doc/uml/7_Claude_Prod_Hook__use_case__d1b9881.puml)

The UML diagram has been generated using enhanced analysis with UML glossary knowledge, providing accurate visualization of the use case concept described in this document.

### ðŸ“‹ Technical Summary
**File:** [7_Claude_Prod_Hook__d1b9881.md](doc/skills/7_Claude_Prod_Hook__d1b9881.md)

The technical summary contains structured metadata, key insights, and AI-optimized content with UML context for automated processing.

### ðŸ“š UML Glossary
**Reference:** [skills/uml-glossary.md](skills/uml-glossary.md)

The comprehensive UML glossary provides definitions and explanations of UML concepts, relationships, and diagram types used in this analysis.

## Key Concepts
- **The**
    - **Production**
    - **Ready**
    - **Claude**
    - **Code**
    - **Hooks**
    - **Guide**
    - **That**
    - **Actually**
    - **Matter**
    - **Stop**
    - **Configuring**
    - **Wrong**
    - **Mistakes**
    - **Breaking**
    - **Implementations**
    - **Reza**
    - **Rezvani**
    - **Follow**
    - **Nov**
    - **You**
    - **PostToolUse**
    - **It**
    - **Now**
    - **Prettier**
    - **Five**
    - **GitHub**
    - **Stack**
    - **Overflow**
    - **Press**
    - **Essential**
    - **Coding**
    - **Workflow**
    - **Image**
    - **Credits**
    - **Gemini**
    - **Pro**
    - **Disclosure**
    - **Most**
    - **This**
    - **Implement**
    - **Understanding**
    - **Hook**
    - **Tiers**
    - **Power**
    - **User**
    - **Tier**
    - **Under**
    - **Auto**
    - **Team**
    - **Compliance**
    - **Complete**
    - **PreCompact**
    - **Skip**
    - **Get**
    - **Docs**
    - **Learn**
    - **Start**
    - **Here**
    - **Minute**
    - **Setup**
    - **Format**
    - **Everything**
    - **Runs**
    - **Eliminates**
    - **Write**
    - **Edit**
    - **Save**
    - **Without**
    - **Multi**
    - **When**
    - **Files**
    - **Session**
    - **Cleanup**
    - **Notifications**
    - **No**
    - **System**
    - **Library**
    - **Sounds**
    - **Glass**
    - **Mobile**
    - **Pushover**
    - **PreToolUse**
    - **Safety**
    - **Gates**
    - **Block**
    - **Create**
    - **Bash**
    - **Dangerous**
    - **Cannot**
    - **Make**
    - **Exit**
    - **Allow**
    - **Other**
    - **Warning**
    - **One**
    - **Scale**
    - **Automation**
    - **Test**
    - **Every**
    - **Automatically**
    - **For**
    - **Check**
    - **Tradeoff**
    - **Immediate**
    - **Tests**
    - **SessionStart**
    - **Load**
    - **Project**
    - **Context**
    - **Inject**
    - **Git**
    - **Status**
    - **Recent**
    - **Commits**
    - **Your**
    - **Open**
    - **Issues**
    - **Configure**
    - **UserPromptSubmit**
    - **Input**
    - **Validation**
    - **Enhancement**
    - **Today**
    - **Policy**
    - **Use**
    - **Audit**
    - **Logging**
    - **All**
    - **Events**
    - **Comprehensive**
    - **Trail**
    - **Logs**
    - **Path**
    - **True**
    - **Could**
    - **Rotate**
    - **Query**
    - **Find**
    - **Daily**
    - **Store**
    - **Troubleshooting**
    - **Why**
    - **Aren**
    - **Working**
    - **Issue**
    - **Configuration**
    - **File**
    - **Symptom**
    - **Root**
    - **They**
    - **Fix**
    - **Run**
    - **Decide**
    - **Put**
    - **Matcher**
    - **Pattern**
    - **Never**
    - **Triggers**
    - **Tool**
    - **Some**
    - **MultiEdit**
    - **Debug**
    - **Empty**
    - **Common**
    - **Command**
    - **Task**
    - **Subagent**
    - **Confusion**
    - **Critical**
    - **Hard**
    - **Important**
    - **Don**
    - **Warn**
    - **Commands**
    - **Cut**
    - **My**
    - **Dev**
    - **Time**
    - **Practical**
    - **Custom**
    - **Permission**
    - **Review**
    - **Skipped**
    - **Security**
    - **Modify**
    - **Restart**
    - **If**
    - **Silent**
    - **Failures**
    - **Python**
    - **Scripts**
    - **Include**
    - **Patterns**
    - **Teams**
    - **Layered**
    - **Global**
    - **Personal**
    - **Everyone**
    - **Performance**
    - **Budget**
    - **Synchronous**
    - **Background**
    - **Error**
    - **Messaging**
    - **Bad**
    - **Good**
    - **To**
    - **Retry**
    - **Helpful**
    - **Techniques**
    - **Turned**
    - **Week**
    - **Projects**
    - **Real**
    - **Simple**
    - **Smart**
    - **Month**
    - **Key**
    - **Troubleshoot**
    - **Which**
    - **Drop**

## Main Takeaways


## UML Analysis Notes

This document was processed using UML glossary knowledge, enabling:
- Accurate diagram type classification
- Enhanced understanding of UML terminology
- Improved visualization based on UML standards
- Better context for technical documentation

## Original Content

---

The Production-Ready Claude Code Hooks Guide: 7 Hooks That Actually Matter
Stop Configuring Claude Code Hooks Wrong: The 5 Mistakes Breaking most of Implementations
Reza Rezvani
Reza Rezvani

Follow
8 min read
Â·
Nov 24, 2025
28






Youâ€™ve configured your PostToolUse hook to auto-format on every file write. It workedâ€¦ once. Now Claude Code ignores it completely, and youâ€™re back to manually running Prettier. Five GitHub issues, three Stack Overflow threads, and two hours later â€” you discover the config lives in the wrong settings.json file.

Press enter or click to view image in full size
7 Essential Claude Code Hooks for your Coding Workflow
7 Essential Claude Code Hooks for your Coding Workflow | Image Credits: Â© Gemini 3 Pro
Disclosure: I used AI tools to help refine and structure this content. The insights and code examples are from my direct work experience or my own research and investigational work.

Most hooks tutorials skip the five configuration landmines that break mostof the implementations: wrong file locations, exit code misunderstandings, matcher patterns that never trigger, missing permissions reviews, and hooks that silently fail without errors.

This guide covers the seven hooks that matter in production, organized by complexity tier. Implement your first essential hook in five minutes, graduate to power-user patterns that eliminate manual QA steps, then optionally deploy the pro-level hook for audit-ready compliance.

Understanding Hook Tiers:
Essential â†’ Power User â†’ Pro
Claude Code offers eight lifecycle events where hooks can execute. You donâ€™t need all eight. Most production workflows run on three to four hooks total.

Essential Tier (3 hooks): Under 15 minutes to implement. Auto-formatting, safety gates, task notifications.

Power User Tier (3 hooks): Team-scale automation. Auto-testing, context loading, input validation.

Pro Tier (1 hook): Compliance and audit requirements. Complete traceability for SOC2/HIPAA.

The eighth hook? PreCompact runs before context window compression. Skip it unless you're building specialized memory management tooling.

Get started with Claude Code hooks - Claude Code Docs
Learn how to customize and extend Claude Code's behavior by registering shell commands
code.claude.com

Essential Hooks: Start Here (5-Minute Setup)
Hook #1 â€” PostToolUse: Auto-Format Everything
Runs immediately after Claude Code writes or edits any file. Eliminates â€œforgot to run Prettierâ€ commits.

{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "prettier --write \"$CLAUDE_FILE_PATHS\" || true"
          }
        ]
      }
    ]
  }
}
Save to ~/.claude/settings.json (global) or .claude/settings.json (project-specific).

The || true suffix prevents formatting failures from blocking Claude Code. Without this, a single malformed file stops all operations.

Multi-language variant:

#!/bin/bash
for file in $CLAUDE_FILE_PATHS; do
  case "$file" in
    *.js|*.jsx|*.ts|*.tsx) prettier --write "$file" ;;
    *.py) black "$file" ;;
    *.go) gofmt -w "$file" ;;
  esac
done
When NOT to use: Files over 10,000 lines where formatting takes longer than 5 seconds.

Hook #2 â€” Stop: Session Cleanup & Notifications
Runs when Claude Code finishes responding. No more checking terminal every 30 seconds wondering if that refactoring job completed.

{
  "hooks": {
    "Stop": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "afplay /System/Library/Sounds/Glass.aiff"
          }
        ]
      }
    ]
  }
}
Mobile notification with Pushover:

curl -s --form-string "token=YOUR_TOKEN" \
  --form-string "user=YOUR_USER" \
  --form-string "message=Claude Code session complete" \
  https://api.pushover.net/1/messages.json
Hook #3 â€” PreToolUse: Safety Gates
Runs BEFORE Claude Code executes tools. Block dangerous commands by returning exit code 2.

Create .claude/hooks/safety_validator.py:

#!/usr/bin/env python3
import json
import sys
import re

data = json.load(sys.stdin)
tool_name = data.get("tool_name", "")
tool_input = data.get("tool_input", {})
# Block dangerous bash commands
if tool_name == "Bash":
    command = tool_input.get("command", "")
    dangerous = [r"rm\s+-rf\s+/", r"rm\s+-rf\s+\*", r"dd\s+if=/dev/zero"]
    
    for pattern in dangerous:
        if re.search(pattern, command):
            print(f"BLOCKED: Dangerous pattern: {pattern}", file=sys.stderr)
            sys.exit(2)
# Block modifications to sensitive files
if tool_name in ["Write", "Edit"]:
    file_path = tool_input.get("file_path", "")
    if any(blocked in file_path for blocked in [".env", "id_rsa"]):
        print(f"BLOCKED: Cannot modify: {file_path}", file=sys.stderr)
        sys.exit(2)
sys.exit(0)
Make executable (chmod +x), then configure:

{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Bash|Write|Edit",
        "hooks": [{"type": "command", "command": ".claude/hooks/safety_validator.py"}]
      }
    ]
  }
}
Exit code strategy:

0: Allow operation
2: Block operation, Claude sees stderr and adjusts
Other: Warning only, execution continues
One fintech team reported 92% reduction in accidental production modifications after implementing PreToolUse safety gates.

Power User Hooks: Team-Scale Automation
Hook #4 â€” PostToolUse: Auto-Test on Every Edit
Automatically runs tests after code changes. TDD without remembering to run tests.

{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_FILE_PATHS\" | grep -q '\\.py$'; then pytest tests/ -v --tb=short || true; fi",
            "timeout": 120
          }
        ]
      }
    ]
  }
}
For large test suites (>30 seconds), run in background:

"command": "pytest tests/ > /tmp/claude-test-results.log 2>&1 &"
Check results with: tail -f /tmp/claude-test-results.log

Tradeoff: Immediate feedback vs. development speed. Tests taking longer than 30 seconds disrupt flow â€” use background execution or move to Stop hook instead.

Hook #5 â€” SessionStart: Load Project Context
Runs when Claude Code starts. Inject git status, open issues, team conventions automatically.

Create .claude/hooks/session_context.sh:

#!/bin/bash
echo "=== Project Context ==="
echo "## Git Status"
git branch --show-current && git status --short
echo ""
echo "## Recent Commits (last 5)"
git log --oneline -5
echo ""
if command -v gh &> /dev/null; then
  echo "## Your Open Issues"
  gh issue list --assignee @me --limit 5
fi
Configure:

{
  "hooks": {
    "SessionStart": [
      {
        "hooks": [{"type": "command", "command": ".claude/hooks/session_context.sh"}]
      }
    ]
  }
}
SessionStart output gets injected directly into Claudeâ€™s context. Claude sees git status and open issues before your first prompt.

This matters most for teams with strict conventions (commit messages, branch naming). Claude follows conventions automatically because theyâ€™re in context from session start.

Hook #6 â€” UserPromptSubmit: Input Validation & Enhancement
Runs when you submit a prompt, BEFORE Claude Code processes it. Auto-append context or validate dangerous requests.

Auto-append current date:

{
  "hooks": {
    "UserPromptSubmit": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "echo \"[Context: Today is $(date +'%Y-%m-%d %A')]\" && cat"
          }
        ]
      }
    ]
  }
}
Block security policy violations:

#!/usr/bin/env python3
import sys

prompt = sys.stdin.read()
forbidden = ["disable auth", "skip validation", "remove rate limit"]
for phrase in forbidden:
    if phrase.lower() in prompt.lower():
        print(f"BLOCKED: Policy violation - '{phrase}'", file=sys.stderr)
        sys.exit(2)
print(prompt)
sys.exit(0)
Use this sparingly â€” reserve for actual security/compliance requirements, not style preferences.

Pro Hook: Audit-Ready Logging
Hook #7 â€” All Events: Comprehensive Audit Trail
Logs every Claude Code action to structured JSON for SOC2/HIPAA compliance, security investigation, debugging.

Create .claude/hooks/audit_logger.py:

#!/usr/bin/env python3
import json
import sys
import os
from datetime import datetime
from pathlib import Path

LOG_DIR = Path.home() / ".claude" / "audit_logs"
LOG_DIR.mkdir(parents=True, exist_ok=True)
try:
    event_data = json.load(sys.stdin)
except json.JSONDecodeError:
    event_data = {"error": "Could not parse stdin"}
audit_entry = {
    "timestamp": datetime.utcnow().isoformat() + "Z",
    "event_type": os.environ.get("CLAUDE_HOOK_EVENT", "unknown"),
    "session_id": os.environ.get("CLAUDE_SESSION_ID", "unknown"),
    "event_data": event_data
}
log_file = LOG_DIR / f"audit_{datetime.utcnow().date()}.jsonl"
with open(log_file, "a") as f:
    f.write(json.dumps(audit_entry) + "\n")
# Rotate logs older than 90 days
import time
cutoff = time.time() - (90 * 24 * 60 * 60)
for old_log in LOG_DIR.glob("audit_*.jsonl"):
    if old_log.stat().st_mtime < cutoff:
        old_log.unlink()
sys.exit(0)
Configure for ALL events:

{
  "hooks": {
    "PreToolUse": [{"hooks": [{"type": "command", "command": ".claude/hooks/audit_logger.py"}]}],
    "PostToolUse": [{"hooks": [{"type": "command", "command": ".claude/hooks/audit_logger.py"}]}],
    "Stop": [{"hooks": [{"type": "command", "command": ".claude/hooks/audit_logger.py"}]}],
    "UserPromptSubmit": [{"hooks": [{"type": "command", "command": ".claude/hooks/audit_logger.py"}]}]
  }
}
Query audit logs:

# Find all file modifications in last 7 days
find ~/.claude/audit_logs -name "audit_*.jsonl" -mtime -7 \
  -exec grep -h "Write\|Edit" {} \; | \
  jq -r '.timestamp + " " + .event_data.tool_input.file_path'
Daily log files average 5â€“10MB. Store on encrypted volumes for sensitive data.

Troubleshooting: Why Your Hooks Arenâ€™t Working
Five issues cause 80% of hook failures. Check these before debugging hook logic.

Issue #1: Wrong Configuration File
Symptom: Hooks configured but never execute.

Root cause: Claude Code reads from two locations â€” ~/.claude/settings.json (global) and .claude/settings.json (project-specific). Project settings completely override global settings. They don't merge.

Fix: Run /hooks in Claude Code to see what's loaded. Check both files. Decide if you want this hook globally or project-specific. Put configuration in exactly one file.

Issue #2: Matcher Pattern Never Triggers
Symptom: Hook configured for "Write" but doesn't fire when Claude Code writes files.

Root cause: Tool names are case-sensitive. Write is different from write. Some operations use Edit or MultiEdit.

Debug pattern:

{
  "hooks": {
    "PreToolUse": [{
      "matcher": "",
      "hooks": [{"type": "command", "command": "echo \"Tool: $CLAUDE_TOOL_NAME\" >> /tmp/tools.log"}]
    }]
  }
}
Empty matcher ("") matches ALL tools. Check /tmp/tools.log after Claude Code operations to see actual tool names.

Common patterns:

"Write|Edit" - File creation and modification
"Bash" - Command execution
"Task" - Subagent delegation
Issue #3: Exit Code Confusion
Symptom: Hook fails but Claude continues (or hook succeeds but Claude stops).

Root cause: Exit code 2 has special meaning â€” it blocks execution and feeds stderr back to Claude. Exit codes 0 and 1 are non-blocking.

Production strategy:

# Critical: block on security violations
if grep -r "API_KEY.*=" "$CLAUDE_FILE_PATHS"; then
  echo "ERROR: Hard-coded API key detected" >&2
  exit 2  # Block this
fi

# Important but not blocking: warn and fix
if ! prettier --check "$CLAUDE_FILE_PATHS"; then
  prettier --write "$CLAUDE_FILE_PATHS"
  exit 0  # Don't block, we fixed it
fi
Block (exit 2) on security violations. Warn (exit 0 or 1) on code style issues.

10 Claude Code Commands That Cut My Dev Time 60%: A Practical Guide
Custom slash commands, subagents, and automation workflows that transformed my teamâ€™s productivity â€” with copy-pasteâ€¦
alirezarezvani.medium.com

Issue #4: Permission Review Skipped
Symptom: Hooks added to settings.json but show â€œpending reviewâ€ forever. Never execute.

Root cause: Security feature â€” hooks require manual approval after configuration changes.

Fix:

Modify .claude/settings.json with your hooks
Restart Claude Code or start new session
Run /hooks command
Review and approve each hook in the interactive menu
This approval step canâ€™t be automated. If hooks auto-approved, malicious config files could execute arbitrary commands without user awareness.

Issue #5: Silent Failures
Symptom: Hook should run but produces no output, no logs, no evidence it executed.

Root cause: Command path issues (hook script not found), missing executables (Python/bash not in PATH), or stderr not being captured.

Debug with echo test:

"command": "echo \"Hook fired at $(date)\" >> /tmp/hook-test.log"
If /tmp/hook-test.log doesn't update after Claude Code writes a file, the hook event itself isn't firing. Check matcher pattern and permissions approval.

If the log updates but your actual hook script doesnâ€™t work, test the command directly in terminal:

cd /path/to/project
export CLAUDE_FILE_PATHS="src/test.py"
.claude/hooks/your_script.sh
Common gotchas:

Scripts need execute permissions: chmod +x .claude/hooks/*
Use absolute paths or $CLAUDE_PROJECT_DIR
Include shebang: #!/bin/bash or #!/usr/bin/env python3
Production Patterns for Teams
Layered Configuration:

Global (~/.claude/settings.json): Personal notifications, productivity shortcuts
Project (.claude/settings.json, in git): Team formatting standards, required tests, security gates
Check project settings into version control. Everyone gets consistent hooks.

Performance Budget:

Synchronous: x seconds (formatting, linting)
Background: >30 seconds (test suites, API calls)
Never: >10 seconds synchronous or interactive commands
Error Messaging for Claude:

When you block with exit code 2, write stderr messages Claude can act on:

Bad: Error: Validation failed

Good:

ERROR: Cannot modify production database without approval.
To proceed:
1. Run with --dry-run flag first
2. Get PR approval from @database-team
3. Retry with approved changes
Claude Code sees this message and adjusts its approach. Helpful error messages turn blocks into guidance.

10 Claude Code 2.0 Techniques That Turned 3-Week Projects
10 Claude Code 2.0 techniques that turned a 3-week project into 3 days. Real production workflows from a CTO who savedâ€¦
alirezarezvani.medium.com

Start Simple, Scale Smart
Week 1: Essential Tier

PostToolUse auto-formatting (5 min)
Stop notifications (5 min)
PreToolUse security gates (15 min)
Week 2â€“3: Power User Tier (if applicable)

Auto-testing on edits
Context loading at session start
Input validation and enhancement
Month 2+: Pro Tier (only if compliance required)

All-events audit logging
Key principles:

Hooks should be invisible â€” if you notice them running, theyâ€™re too slow
Check project hooks into git for team consistency
Troubleshoot the five configuration landmines first before debugging hook logic
Start with Hook #1 today
Which hook are you implementing first? Drop a comment with your workflow challenge â€” Iâ€™ll suggest the right hook pattern for your situation.

